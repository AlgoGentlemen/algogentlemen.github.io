<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.6.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.6.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.6.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.6.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="From Wikipedia: The travelling salesman problem (TSP) asks the following question: &amp;quot;Given a list of cities and the distances between each pair of cities, what is the shortest possible route that">
<meta property="og:type" content="article">
<meta property="og:title" content="DP solution for TSP Problems">
<meta property="og:url" content="https://csgentlemen.github.io/2018/11/16/DP-solution-for-TSP-Problems/index.html">
<meta property="og:site_name" content="CS Gentlemen Club">
<meta property="og:description" content="From Wikipedia: The travelling salesman problem (TSP) asks the following question: &amp;quot;Given a list of cities and the distances between each pair of cities, what is the shortest possible route that">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-02-06T19:30:20.653Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="DP solution for TSP Problems">
<meta name="twitter:description" content="From Wikipedia: The travelling salesman problem (TSP) asks the following question: &amp;quot;Given a list of cities and the distances between each pair of cities, what is the shortest possible route that">






  <link rel="canonical" href="https://csgentlemen.github.io/2018/11/16/DP-solution-for-TSP-Problems/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>DP solution for TSP Problems | CS Gentlemen Club</title>
  











  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">CS Gentlemen Club</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-鉴与屑">

    
    
    
      
    

    

    <a href="/likes/" rel="section"><i class="menu-item-icon fa fa-fw fa-heart"></i> <br>鉴与屑</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://csgentlemen.github.io/2018/11/16/DP-solution-for-TSP-Problems/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="CS Gentlemen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CS Gentlemen Club">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">DP solution for TSP Problems
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-11-16 21:00:16" itemprop="dateCreated datePublished" datetime="2018-11-16T21:00:16+00:00">2018-11-16</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-02-06 19:30:20" itemprop="dateModified" datetime="2019-02-06T19:30:20+00:00">2019-02-06</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>From <a href="https://en.wikipedia.org/wiki/Travelling_salesman_problem" target="_blank" rel="noopener">Wikipedia</a>: The travelling salesman problem (TSP) asks the following question: &quot;Given a list of cities and the distances between each pair of cities, what is the shortest possible route that visits each city and returns to the origin city?&quot; It is an NP-hard problem in combinatorial optimization, important in operations research and theoretical computer science.</p>
</blockquote>
<p>Let's consider a variant of TSP problem such that we fix the first city and the last city of this travel and there are <span class="math inline">\(n+2\)</span> cities in total.</p>
<p>The naive brute force method to solve TSP problem has <span class="math inline">\(O((n+1)!)\)</span> time complexity. In this post, we introduce a DP algorithm that works in <span class="math inline">\(O(n^2 2^n)\)</span> time complexity and <span class="math inline">\(O(n 2^n)\)</span> space complexity. There are also other methods like branch and bound method that we would not cover in this post. <a id="more"></a></p>
<h1 id="dp-space-and-recurrence">DP Space and Recurrence</h1>
<p>One reason the naive algorithm is inefficient is that it has saved a lot of <em>unnecessary ordering information</em> of visited cities and there are actually overlapping between subproblems. Consider two incomplete paths <code>A B C</code> and <code>B A C</code>, they are actually equavalent because they have visited the same set of cities and have the same current city.</p>
<p>Our DP space intend to capture all intermediate states where some cities are visited but others are not. To eliminate the redundant information or ordering, our DP state space only care the <strong>current city</strong> and <strong>set of visited cities</strong>. The current city has <span class="math inline">\(n\)</span> choices, and every city except current one could be visited or not. Consequently, the total state space by rule of product is <span class="math display">\[n 2^{n-1}\]</span> To make our later implementation easier, we ignore that the current city must be visited and use a larger DP space of size <span class="math inline">\(n 2^n\)</span>. These extra space however does not affect our result.</p>
<p>Our next step is to write the recurrence of DP. Clearly, we should go to our current state from a previous city. Let's say we are at city <span class="math inline">\(c_m\)</span> and we have visited cities <span class="math inline">\(C=\{c_1, c_2,\ldots, c_{k-1}, c_k\}\)</span>. This state is denoted by the tuple <span class="math inline">\((c_m, C)\)</span>. To arrive at current city, we could go from any previous state <span class="math display">\[(c_n, C\setminus\{c_m\}),\quad c_n\in C\setminus\{c_m\}\]</span> with an extra cost <span class="math inline">\(d(c_m, c_n)\)</span>.</p>
<h1 id="implementation">Implementation</h1>
<h2 id="representation-of-set-of-cities">Representation of Set of Cities</h2>
<p>We use a 32-bit integer to represent the set of cities (less than 32). Existence of the <span class="math inline">\(i\)</span>-th city corresponds to <span class="math inline">\(i\)</span>-th bit of the integer.</p>
<h2 id="data-dependency-and-dp-updates">Data Dependency and DP updates</h2>
<p>It is obvious that one state only has dependency on other state with a smaller set of cities, which corresponds to a smaller integer in our representation. So we enumerate all set of travelled cities by ascending order of their integer i.e. <span class="math inline">\(0, 1, 2, \ldots, 2^n-1\)</span>.</p>
<h2 id="code">Code</h2>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">inf = float(<span class="string">'inf'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">highbit_range</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> range(n):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>&lt;&lt;h, <span class="number">1</span>&lt;&lt;(h+<span class="number">1</span>)):</span><br><span class="line">            <span class="keyword">yield</span> h, i</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">last_two_bits</span><span class="params">(h, cur)</span>:</span></span><br><span class="line">    l = [k <span class="keyword">for</span> k <span class="keyword">in</span> range(h) <span class="keyword">if</span> (<span class="number">1</span>&lt;&lt;k)&amp;cur]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> l: <span class="keyword">return</span> []</span><br><span class="line">    l.append(h)</span><br><span class="line">    <span class="keyword">return</span> ((i, j) <span class="keyword">for</span> i <span class="keyword">in</span> l <span class="keyword">for</span> j <span class="keyword">in</span> l <span class="keyword">if</span> i!=j)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">simple_tsp</span><span class="params">(d_s, d_e, dist)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Args</span></span><br><span class="line"><span class="string">    ====</span></span><br><span class="line"><span class="string">    d_s: distance from start to intermediate nodes</span></span><br><span class="line"><span class="string">    d_e: distance from intermediate nodes to end</span></span><br><span class="line"><span class="string">    dist: The adjacent matrix storing shortest path between each pair of intermediate nodes</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Example:</span></span><br><span class="line"><span class="string">    ====</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; simple_tsp([1,2,3], [4,5,6], [[0,2,4], [2,0,5], [4,5,0]])</span></span><br><span class="line"><span class="string">    14</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    n = len(dist)</span><br><span class="line">    dp = [[inf]*(<span class="number">2</span>**n) <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        dp[i][<span class="number">1</span>&lt;&lt;i] = d_s[i]</span><br><span class="line">    <span class="keyword">for</span> h, cur <span class="keyword">in</span> highbit_range(n):</span><br><span class="line">        <span class="keyword">for</span> last, last2 <span class="keyword">in</span> last_two_bits(h, cur):</span><br><span class="line">            prev = cur^(<span class="number">1</span>&lt;&lt;last)</span><br><span class="line">            dp[last][cur] = min(dp[last2][prev]+dist[last2][last], dp[last][cur])</span><br><span class="line">    complete = (<span class="number">1</span>&lt;&lt;n)<span class="number">-1</span></span><br><span class="line">    <span class="keyword">return</span> min(dp[last][complete]+d_e[last] <span class="keyword">for</span> last <span class="keyword">in</span> range(n))</span><br></pre></td></tr></table></figure>
<h2 id="examples">Examples</h2>
<ul>
<li>lc847. Shortest Path Visiting All Nodes</li>
<li>lc943. Find the Shortest Superstring</li>
</ul>

      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/11/16/Expectation-Maximization/" rel="next" title="EM算法与Word Alignment">
                <i class="fa fa-chevron-left"></i> EM算法与Word Alignment
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/12/01/试谈一下Onepass算法/" rel="prev" title="试谈一下Onepass算法">
                试谈一下Onepass算法 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">CS Gentlemen</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">5</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#dp-space-and-recurrence"><span class="nav-number">1.</span> <span class="nav-text">DP Space and Recurrence</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#implementation"><span class="nav-number">2.</span> <span class="nav-text">Implementation</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#representation-of-set-of-cities"><span class="nav-number">2.1.</span> <span class="nav-text">Representation of Set of Cities</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#data-dependency-and-dp-updates"><span class="nav-number">2.2.</span> <span class="nav-text">Data Dependency and DP updates</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#code"><span class="nav-number">2.3.</span> <span class="nav-text">Code</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#examples"><span class="nav-number">2.4.</span> <span class="nav-text">Examples</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CS Gentlemen</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v6.6.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.6.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.6.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.6.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.6.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.6.0"></script>



  



  










  





  

  

  

  

  
  

  
  

  
    
      <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      },
      TeX: {equationNumbers: { autoNumber: "AMS" }}
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<script type="text/javascript" src="//cdn.jsdelivr.net/npm/mathjax@2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

<style>
.MathJax_Display {
    overflow: auto hidden;
}
</style><!-- hexo-inject:begin --><!-- hexo-inject:end -->

    
  


  
  

  

  

  

  

  

  

</body>
</html>
